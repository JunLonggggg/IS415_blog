<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>hands-on-exercise-10</title>

  <meta property="description" itemprop="description" content="In this lesson, we will be learning about Spatial Interaction Models."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-10-25"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-10-25"/>
  <meta name="article:author" content="Toh Jun Long"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="hands-on-exercise-10"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this lesson, we will be learning about Spatial Interaction Models."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="hands-on-exercise-10"/>
  <meta property="twitter:description" content="In this lesson, we will be learning about Spatial Interaction Models."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["hands-on-exercise-10"]},{"type":"character","attributes":{},"value":["In this lesson, we will be learning about Spatial Interaction Models.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Toh Jun Long"]},{"type":"character","attributes":{},"value":["https://linkedin.com/in/tohjunlong"]}]}]},{"type":"character","attributes":{},"value":["10-25-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["hands-on-exercise-10_files/figure-html5/unnamed-chunk-11-1.png","hands-on-exercise-10_files/figure-html5/unnamed-chunk-30-1.png","hands-on-exercise-10_files/figure-html5/unnamed-chunk-39-1.png","hands-on-exercise-10_files/figure-html5/unnamed-chunk-45-1.png","hands-on-exercise-10_files/figure-html5/unnamed-chunk-51-1.png","hands-on-exercise-10_files/figure-html5/unnamed-chunk-57-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refHtml = $('#ref-' + $(this).attr('data-cites')).html();
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="hands-on-exercise-10_files/header-attrs-2.11/header-attrs.js"></script>
  <script src="hands-on-exercise-10_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="hands-on-exercise-10_files/popper-2.6.0/popper.min.js"></script>
  <link href="hands-on-exercise-10_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="hands-on-exercise-10_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="hands-on-exercise-10_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="hands-on-exercise-10_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="hands-on-exercise-10_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="hands-on-exercise-10_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="hands-on-exercise-10_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"hands-on-exercise-10","description":"In this lesson, we will be learning about Spatial Interaction Models.","authors":[{"author":"Toh Jun Long","authorURL":"https://linkedin.com/in/tohjunlong","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-10-25T00:00:00.000+08:00","citationText":"Long, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>hands-on-exercise-10</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>In this lesson, we will be learning about Spatial Interaction Models.</p></p>
</div>

<div class="d-byline">
  Toh Jun Long <a href="https://linkedin.com/in/tohjunlong" class="uri">https://linkedin.com/in/tohjunlong</a> 
  
<br/>10-25-2021
</div>

<div class="d-article">
<p>Before we getting started, it is important for us to install the necessary R packages and launch them into RStudio environment.</p>
<p>The R packages need for this exercise are as follows:</p>
<ul>
<li>Spatial data handling</li>
<li>sf, sp, geojsonio, stplanr.</li>
<li>Attribute data handling</li>
<li>tidyverse, especially readr and dplyr, reshape2,</li>
<li>thematic mapping</li>
<li>tmap</li>
<li>Statistical graphic</li>
<li>ggplot2</li>
<li>Statistical analysis</li>
<li>caret</li>
</ul>
<p>The code chunk below installs and launches these R packages into RStudio environment.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>packages</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'tmap'</span>, <span class='st'>'tidyverse'</span>,
             <span class='st'>'sp'</span>, <span class='st'>'caret'</span>,
             <span class='st'>'geojsonio'</span>, <span class='st'>'reshape2'</span>, 
             <span class='st'>'broom'</span><span class='op'>)</span>

<span class='kw'>for</span><span class='op'>(</span><span class='va'>p</span> <span class='kw'>in</span> <span class='va'>packages</span><span class='op'>)</span><span class='op'>{</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='op'>!</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'>p</span>, character.only <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/r/utils/install.packages.html'>install.packages</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>p</span>, character.only <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># library(devtools)</span>
<span class='co'># install_version("sf", version = "0.9-8", repos = "http://cran.us.r-project.org")</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># library(devtools)</span>
<span class='co'># install_version("stplanr", version = "0.8.4", repos = "http://cran.us.r-project.org")</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/stplanr'>stplanr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>Aus</span> <span class='op'>&lt;-</span> <span class='fu'>geojson_read</span><span class='op'>(</span><span class='st'>"https://www.dropbox.com/s/0fg80nzcxcsybii/GCCSA_2016_AUST_New.geojson?raw=1"</span>, what <span class='op'>=</span> <span class='st'>"sp"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>Ausdata</span> <span class='op'>&lt;-</span> <span class='va'>Aus</span><span class='op'>@</span><span class='va'>data</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>AusSF</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='va'>Aus</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_crs.html'>st_set_crs</a></span><span class='op'>(</span><span class='fl'>4283</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://r-spatial.github.io/sf/reference/valid.html'>st_is_valid</a></span><span class='op'>(</span><span class='va'>AusSF</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
[12] FALSE  TRUE  TRUE  TRUE</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://r-spatial.github.io/sf/reference/valid.html'>st_make_valid</a></span><span class='op'>(</span><span class='va'>AusSF</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Simple feature collection with 15 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 112.9211 ymin: -43.74051 xmax: 159.1092 ymax: -9.142176
Geodetic CRS:  GDA94
First 10 features:
   GCCSA_CODE GCC_CODE16        GCCSA_NAME STATE_CODE
1       1RNSW      1RNSW       Rest of NSW          1
2       1GSYD      1GSYD    Greater Sydney          1
3       2GMEL      2GMEL Greater Melbourne          2
4       2RVIC      2RVIC      Rest of Vic.          2
5       3RQLD      3RQLD       Rest of Qld          3
6       3GBRI      3GBRI  Greater Brisbane          3
7       4RSAU      4RSAU        Rest of SA          4
8       4GADE      4GADE  Greater Adelaide          4
9       5GPER      5GPER     Greater Perth          5
10      5RWAU      5RWAU        Rest of WA          5
          STATE_NAME   AREA_SQKM                       geometry
1    New South Wales  788442.589 MULTIPOLYGON (((159.0611 -3...
2    New South Wales   12368.193 MULTIPOLYGON (((151.266 -33...
3           Victoria    9992.512 MULTIPOLYGON (((144.9065 -3...
4           Victoria  217503.119 MULTIPOLYGON (((146.6858 -3...
5         Queensland 1714330.123 MULTIPOLYGON (((150.7377 -2...
6         Queensland   15841.960 MULTIPOLYGON (((153.3738 -2...
7    South Australia  981015.072 MULTIPOLYGON (((136.1844 -3...
8    South Australia    3259.836 MULTIPOLYGON (((138.5269 -3...
9  Western Australia    6416.222 MULTIPOLYGON (((115.7132 -3...
10 Western Australia 2520230.017 MULTIPOLYGON (((117.896 -35...</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://r-spatial.github.io/sf/reference/valid.html'>st_is_valid</a></span><span class='op'>(</span><span class='va'>AusSF</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code> [1]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
[12] FALSE  TRUE  TRUE  TRUE</code></pre>
</div>
<p>Plot the boundary layer</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tmap_options</span><span class='op'>(</span>check.and.fix <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'>tmap_mode</span><span class='op'>(</span><span class='st'>"plot"</span><span class='op'>)</span>
<span class='fu'>qtm</span><span class='op'>(</span><span class='va'>AusSF</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-11-1.png" width="624" /></p>
</div>
<h1 id="displaying-data-table">Displaying data table</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>AusSF</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Simple feature collection with 10 features and 6 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 112.9211 ymin: -39.15919 xmax: 159.1092 ymax: -9.142176
Geodetic CRS:  GDA94
   GCCSA_CODE GCC_CODE16        GCCSA_NAME STATE_CODE
1       1RNSW      1RNSW       Rest of NSW          1
2       1GSYD      1GSYD    Greater Sydney          1
3       2GMEL      2GMEL Greater Melbourne          2
4       2RVIC      2RVIC      Rest of Vic.          2
5       3RQLD      3RQLD       Rest of Qld          3
6       3GBRI      3GBRI  Greater Brisbane          3
7       4RSAU      4RSAU        Rest of SA          4
8       4GADE      4GADE  Greater Adelaide          4
9       5GPER      5GPER     Greater Perth          5
10      5RWAU      5RWAU        Rest of WA          5
          STATE_NAME   AREA_SQKM                       geometry
1    New South Wales  788442.589 MULTIPOLYGON (((159.061 -31...
2    New South Wales   12368.193 MULTIPOLYGON (((151.2658 -3...
3           Victoria    9992.512 MULTIPOLYGON (((144.9063 -3...
4           Victoria  217503.119 MULTIPOLYGON (((146.6857 -3...
5         Queensland 1714330.123 MULTIPOLYGON (((150.7374 -2...
6         Queensland   15841.960 MULTIPOLYGON (((153.374 -27...
7    South Australia  981015.072 MULTIPOLYGON (((136.1839 -3...
8    South Australia    3259.836 MULTIPOLYGON (((138.5262 -3...
9  Western Australia    6416.222 MULTIPOLYGON (((115.7128 -3...
10 Western Australia 2520230.017 MULTIPOLYGON (((117.8946 -3...</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>Aus</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://r-spatial.github.io/sf/reference/coerce-methods.html'>as</a></span><span class='op'>(</span><span class='va'>AusSF</span>, <span class='st'>"Spatial"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="calculating-a-distance-matrix">Calculating a distance matrix</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>AusProj</span> <span class='op'>&lt;-</span> <span class='fu'>spTransform</span><span class='op'>(</span><span class='va'>Aus</span>,<span class='st'>"+init=epsg:3112"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>AusProj</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Object of class SpatialPolygonsDataFrame
Coordinates:
       min      max
x -2083066  2346598
y -4973093 -1115948
Is projected: TRUE 
proj4string :
[+proj=lcc +lat_0=0 +lon_0=134 +lat_1=-18 +lat_2=-36 +x_0=0
+y_0=0 +ellps=GRS80 +units=m +no_defs]
Data attributes:
  GCCSA_CODE         GCC_CODE16         GCCSA_NAME       
 Length:15          Length:15          Length:15         
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
  STATE_CODE         STATE_NAME          AREA_SQKM      
 Length:15          Length:15          Min.   :   1695  
 Class :character   Class :character   1st Qu.:   4838  
 Mode  :character   Mode  :character   Median :  15842  
                                       Mean   : 512525  
                                       3rd Qu.: 884729  
                                       Max.   :2520230  </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dist</span> <span class='op'>&lt;-</span> <span class='fu'>spDists</span><span class='op'>(</span><span class='va'>AusProj</span><span class='op'>)</span>
<span class='va'>dist</span> 
</code></pre>
</div>
<pre><code>           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
 [1,]       0.0  391437.9  644760.8  571477.3 1100378.3  750755.8
 [2,]  391437.9       0.0  682745.0  685848.4 1386485.4  707908.1
 [3,]  644760.8  682745.0       0.0  133469.9 1694648.9 1337408.0
 [4,]  571477.3  685848.4  133469.9       0.0 1584991.5 1296766.5
 [5,] 1100378.3 1386485.4 1694648.9 1584991.5       0.0  998492.1
 [6,]  750755.8  707908.1 1337408.0 1296766.5  998492.1       0.0
 [7,] 1082754.7 1462171.3 1212525.3 1081939.7 1192252.9 1655212.1
 [8,]  819629.7 1112315.7  657875.7  541576.5 1477964.9 1550134.5
 [9,] 2891531.5 3226086.3 2722337.4 2633416.1 2962834.0 3531418.0
[10,] 2490287.4 2870995.7 2542772.5 2424001.8 2239419.3 2993729.9
[11,] 1192833.0 1064848.2  603165.2  731624.1 2280386.7 1772756.1
[12,] 1096764.5  999758.0  489273.6  615173.0 2176139.6 1705581.2
[13,] 1945803.1 2323414.2 2323404.3 2190310.9 1183495.9 2143514.5
[14,] 2699307.7 3062979.3 3113837.0 2981210.5 1782227.9 2780660.8
[15,]  412697.8  256289.3  430815.8  452584.3 1505884.6  948547.6
           [,7]      [,8]      [,9]     [,10]     [,11]     [,12]
 [1,] 1082754.7  819629.7 2891531.5 2490287.4 1192833.0 1096764.5
 [2,] 1462171.3 1112315.7 3226086.3 2870995.7 1064848.2  999758.0
 [3,] 1212525.3  657875.7 2722337.4 2542772.5  603165.2  489273.6
 [4,] 1081939.7  541576.5 2633416.1 2424001.8  731624.1  615173.0
 [5,] 1192252.9 1477964.9 2962834.0 2239419.3 2280386.7 2176139.6
 [6,] 1655212.1 1550134.5 3531418.0 2993729.9 1772756.1 1705581.2
 [7,]       0.0  602441.7 1879873.6 1408864.5 1765685.0 1644255.7
 [8,]  602441.7       0.0 2120117.7 1884897.3 1170300.0 1049301.5
 [9,] 1879873.6 2120117.7       0.0  963094.8 3030825.1 2933427.1
[10,] 1408864.5 1884897.3  963094.8       0.0 3007005.8 2891500.6
[11,] 1765685.0 1170300.0 3030825.1 3007005.8       0.0  121449.6
[12,] 1644255.7 1049301.5 2933427.1 2891500.6  121449.6       0.0
[13,] 1198930.8 1788551.3 2215369.4 1302498.1 2913873.5 2793570.5
[14,] 1991775.4 2584759.7 2648782.4 1686414.7 3707567.5 3587636.5
[15,] 1368380.0  936272.3 3055551.0 2766083.4  835822.4  759587.0
        [,13]   [,14]     [,15]
 [1,] 1945803 2699308  412697.8
 [2,] 2323414 3062979  256289.3
 [3,] 2323404 3113837  430815.8
 [4,] 2190311 2981211  452584.3
 [5,] 1183496 1782228 1505884.6
 [6,] 2143514 2780661  948547.6
 [7,] 1198931 1991775 1368380.0
 [8,] 1788551 2584760  936272.3
 [9,] 2215369 2648782 3055551.0
[10,] 1302498 1686415 2766083.4
[11,] 2913873 3707567  835822.4
[12,] 2793570 3587637  759587.0
[13,]       0  796710 2337203.6
[14,]  796710       0 3101576.8
[15,] 2337204 3101577       0.0</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>distPair</span> <span class='op'>&lt;-</span> <span class='fu'>melt</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>distPair</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   Var1 Var2     value
1     1    1       0.0
2     2    1  391437.9
3     3    1  644760.8
4     4    1  571477.3
5     5    1 1100378.3
6     6    1  750755.8
7     7    1 1082754.7
8     8    1  819629.7
9     9    1 2891531.5
10   10    1 2490287.4</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>distPair</span><span class='op'>$</span><span class='va'>value</span> <span class='op'>&lt;-</span> <span class='va'>distPair</span><span class='op'>$</span><span class='va'>value</span> <span class='op'>/</span> <span class='fl'>1000</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>distPair</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   Var1 Var2     value
1     1    1    0.0000
2     2    1  391.4379
3     3    1  644.7608
4     4    1  571.4773
5     5    1 1100.3783
6     6    1  750.7558
7     7    1 1082.7547
8     8    1  819.6297
9     9    1 2891.5315
10   10    1 2490.2874</code></pre>
</div>
<h2 id="converting-distance-matrix-into-distance-pair-list">Converting distance matrix into distance pair list</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>distPair</span> <span class='op'>&lt;-</span> <span class='fu'>melt</span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>distPair</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   Var1 Var2     value
1     1    1       0.0
2     2    1  391437.9
3     3    1  644760.8
4     4    1  571477.3
5     5    1 1100378.3
6     6    1  750755.8
7     7    1 1082754.7
8     8    1  819629.7
9     9    1 2891531.5
10   10    1 2490287.4</code></pre>
</div>
<h2 id="converting-unit-of-measurement-from-metres-into-km">Converting unit of measurement from metres into km</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>distPair</span><span class='op'>$</span><span class='va'>value</span> <span class='op'>&lt;-</span> <span class='va'>distPair</span><span class='op'>$</span><span class='va'>value</span> <span class='op'>/</span> <span class='fl'>1000</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>distPair</span>, <span class='fl'>10</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   Var1 Var2     value
1     1    1    0.0000
2     2    1  391.4379
3     3    1  644.7608
4     4    1  571.4773
5     5    1 1100.3783
6     6    1  750.7558
7     7    1 1082.7547
8     8    1  819.6297
9     9    1 2891.5315
10   10    1 2490.2874</code></pre>
</div>
<h1 id="importing-interaction-data">Importing Interaction Data</h1>
<p>Importing in the migration data into rstudio</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdata</span> <span class='op'>&lt;-</span> <span class='fu'>read_csv</span><span class='op'>(</span><span class='st'>"https://www.dropbox.com/s/wi3zxlq5pff1yda/AusMig2011.csv?raw=1"</span>,col_names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'>glimpse</span><span class='op'>(</span><span class='va'>mdata</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 225
Columns: 13
$ Origin          &lt;chr&gt; &quot;Greater Sydney&quot;, &quot;Greater Sydney&quot;, &quot;Greater~
$ Orig_code       &lt;chr&gt; &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;,~
$ Destination     &lt;chr&gt; &quot;Greater Sydney&quot;, &quot;Rest of NSW&quot;, &quot;Greater Me~
$ Dest_code       &lt;chr&gt; &quot;1GSYD&quot;, &quot;1RNSW&quot;, &quot;2GMEL&quot;, &quot;2RVIC&quot;, &quot;3GBRI&quot;,~
$ Flow            &lt;dbl&gt; 3395015, 91031, 22601, 4416, 22888, 27445, 5~
$ vi1_origpop     &lt;dbl&gt; 4391673, 4391673, 4391673, 4391673, 4391673,~
$ wj1_destpop     &lt;dbl&gt; 4391673, 2512952, 3999981, 1345717, 2065998,~
$ vi2_origunemp   &lt;dbl&gt; 5.74, 5.74, 5.74, 5.74, 5.74, 5.74, 5.74, 5.~
$ wj2_destunemp   &lt;dbl&gt; 5.74, 6.12, 5.47, 5.17, 5.86, 6.22, 5.78, 5.~
$ vi3_origmedinc  &lt;dbl&gt; 780.64, 780.64, 780.64, 780.64, 780.64, 780.~
$ wj3_destmedinc  &lt;dbl&gt; 780.64, 509.97, 407.95, 506.58, 767.08, 446.~
$ vi4_origpctrent &lt;dbl&gt; 31.77, 31.77, 31.77, 31.77, 31.77, 31.77, 31~
$ wj4_destpctrent &lt;dbl&gt; 31.77, 27.20, 27.34, 24.08, 33.19, 32.57, 28~</code></pre>
</div>
<h2 id="combining-the-imported-migration-data">Combining the imported migration data</h2>
<ul>
<li>Add in generated distance data</li>
<li>Create new column of total flows, excluding flows that occur within an area (intra-area)</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdata</span><span class='op'>$</span><span class='va'>FlowNoIntra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>mdata</span><span class='op'>$</span><span class='va'>Orig_code</span> <span class='op'>==</span> <span class='va'>mdata</span><span class='op'>$</span><span class='va'>Dest_code</span>,<span class='fl'>0</span>,<span class='va'>mdata</span><span class='op'>$</span><span class='va'>Flow</span><span class='op'>)</span>
<span class='va'>mdata</span><span class='op'>$</span><span class='va'>offset</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>mdata</span><span class='op'>$</span><span class='va'>Orig_code</span> <span class='op'>==</span> <span class='va'>mdata</span><span class='op'>$</span><span class='va'>Dest_code</span>,<span class='fl'>0.0000000001</span>,<span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Ordering the spatial data by code order.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdata</span><span class='op'>$</span><span class='va'>dist</span> <span class='op'>&lt;-</span> <span class='va'>distPair</span><span class='op'>$</span><span class='va'>value</span> 
</code></pre>
</div>
</div>
<p>Setting intr-zonal distance to be near 0 and not exactly 0</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdata</span><span class='op'>$</span><span class='va'>dist</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>mdata</span><span class='op'>$</span><span class='va'>dist</span> <span class='op'>==</span> <span class='fl'>0</span>,<span class='fl'>5</span>,<span class='va'>mdata</span><span class='op'>$</span><span class='va'>dist</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>glimpse</span><span class='op'>(</span><span class='va'>mdata</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Rows: 225
Columns: 16
$ Origin          &lt;chr&gt; &quot;Greater Sydney&quot;, &quot;Greater Sydney&quot;, &quot;Greater~
$ Orig_code       &lt;chr&gt; &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;, &quot;1GSYD&quot;,~
$ Destination     &lt;chr&gt; &quot;Greater Sydney&quot;, &quot;Rest of NSW&quot;, &quot;Greater Me~
$ Dest_code       &lt;chr&gt; &quot;1GSYD&quot;, &quot;1RNSW&quot;, &quot;2GMEL&quot;, &quot;2RVIC&quot;, &quot;3GBRI&quot;,~
$ Flow            &lt;dbl&gt; 3395015, 91031, 22601, 4416, 22888, 27445, 5~
$ vi1_origpop     &lt;dbl&gt; 4391673, 4391673, 4391673, 4391673, 4391673,~
$ wj1_destpop     &lt;dbl&gt; 4391673, 2512952, 3999981, 1345717, 2065998,~
$ vi2_origunemp   &lt;dbl&gt; 5.74, 5.74, 5.74, 5.74, 5.74, 5.74, 5.74, 5.~
$ wj2_destunemp   &lt;dbl&gt; 5.74, 6.12, 5.47, 5.17, 5.86, 6.22, 5.78, 5.~
$ vi3_origmedinc  &lt;dbl&gt; 780.64, 780.64, 780.64, 780.64, 780.64, 780.~
$ wj3_destmedinc  &lt;dbl&gt; 780.64, 509.97, 407.95, 506.58, 767.08, 446.~
$ vi4_origpctrent &lt;dbl&gt; 31.77, 31.77, 31.77, 31.77, 31.77, 31.77, 31~
$ wj4_destpctrent &lt;dbl&gt; 31.77, 27.20, 27.34, 24.08, 33.19, 32.57, 28~
$ FlowNoIntra     &lt;dbl&gt; 0, 91031, 22601, 4416, 22888, 27445, 5817, 7~
$ offset          &lt;dbl&gt; 1e-10, 1e+00, 1e+00, 1e+00, 1e+00, 1e+00, 1e~
$ dist            &lt;dbl&gt; 5.0000, 391.4379, 644.7608, 571.4773, 1100.3~</code></pre>
</div>
<h1 id="visualising-with-desire-line">Visualising with desire line</h1>
<p>We will not plot the intra-zonal flows. The code chunk below will be used to remove intra-zonal flows.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span> <span class='op'>&lt;-</span> <span class='va'>mdata</span><span class='op'>[</span><span class='va'>mdata</span><span class='op'>$</span><span class='va'>Orig_code</span><span class='op'>!=</span><span class='va'>mdata</span><span class='op'>$</span><span class='va'>Dest_code</span>,<span class='op'>]</span>
</code></pre>
</div>
</div>
<p>Removing all exceprt origin, dest and flow cols</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub_skinny</span> <span class='op'>&lt;-</span> <span class='va'>mdatasub</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>]</span>
<span class='va'>travel_network</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://docs.ropensci.org/stplanr/reference/od2line.html'>od2line</a></span><span class='op'>(</span>flow <span class='op'>=</span> <span class='va'>mdatasub_skinny</span>, 
                          zones <span class='op'>=</span> <span class='va'>Aus</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Converting to WGS84 projection</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>travel_networkwgs</span> <span class='op'>&lt;-</span> <span class='fu'>spTransform</span><span class='op'>(</span><span class='va'>travel_network</span>,<span class='st'>"+init=epsg:4326"</span> <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Same for Aus layer</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>AusWGS</span> <span class='op'>&lt;-</span> <span class='fu'>spTransform</span><span class='op'>(</span><span class='va'>Aus</span>,<span class='st'>"+init=epsg:4326"</span> <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Setting a more meaningful value for line widths</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>w</span> <span class='op'>&lt;-</span> <span class='va'>mdatasub_skinny</span><span class='op'>$</span><span class='va'>Flow</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>mdatasub_skinny</span><span class='op'>$</span><span class='va'>Flow</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>10</span>
</code></pre>
</div>
</div>
<p>Plotting the interaction line onto a map</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>travel_networkwgs</span>, lwd <span class='op'>=</span> <span class='va'>w</span><span class='op'>)</span>
<span class='fu'><a href='https://r-spatial.github.io/sf/reference/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>AusWGS</span>, add<span class='op'>=</span><span class='cn'>T</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<h1 id="building-spatial-interaction-models">Building Spatial Interaction Models</h1>
<h2 id="unconstrained-spatial-interaction-model">Unconstrained Spatial Interaction Model</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>uncosim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>Flow</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>vi1_origpop</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>wj3_destmedinc</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span>, na.action <span class='op'>=</span> <span class='va'>na.exclude</span>, family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>mdatasub</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>uncosim</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = Flow ~ log(vi1_origpop) + log(wj3_destmedinc) + 
    log(dist), family = poisson(link = &quot;log&quot;), data = mdatasub, 
    na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-179.76   -57.41   -22.85     9.83   468.92  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)          7.4435365  0.0248322  299.75   &lt;2e-16 ***
log(vi1_origpop)     0.5928768  0.0009145  648.28   &lt;2e-16 ***
log(wj3_destmedinc) -0.1933096  0.0033602  -57.53   &lt;2e-16 ***
log(dist)           -0.8290204  0.0010152 -816.62   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2750417  on 209  degrees of freedom
Residual deviance: 1478832  on 206  degrees of freedom
AIC: 1480839

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<h2 id="fitting-the-model">Fitting the model</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>fitted</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>uncosim</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="optional-another-method-to-calculate-the-estimates.">(Optional) Another method to calculate the estimates.</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>k</span> <span class='op'>&lt;-</span> <span class='va'>uncosim</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
<span class='va'>mu</span> <span class='op'>&lt;-</span> <span class='va'>uncosim</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>
<span class='va'>alpha</span> <span class='op'>&lt;-</span> <span class='va'>uncosim</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span>
<span class='va'>beta</span> <span class='op'>&lt;-</span> <span class='op'>-</span><span class='va'>uncosim</span><span class='op'>$</span><span class='va'>coefficients</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>k</span><span class='op'>+</span><span class='op'>(</span><span class='va'>mu</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>vi1_origpop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span><span class='op'>(</span><span class='va'>alpha</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>wj3_destmedinc</span><span class='op'>)</span><span class='op'>)</span><span class='op'>-</span><span class='op'>(</span><span class='va'>beta</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>dist</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>k</span><span class='op'>)</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>mu</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>vi1_origpop</span><span class='op'>)</span><span class='op'>)</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>alpha</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>wj3_destmedinc</span><span class='op'>)</span><span class='op'>)</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>beta</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>dist</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="saving-the-fitted-values">Saving the fitted values</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span>,<span class='fl'>0</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 1313514</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat2</span> <span class='op'>&lt;-</span> <span class='fu'>dcast</span><span class='op'>(</span><span class='va'>mdatasub</span>, <span class='va'>Orig_code</span> <span class='op'>~</span> <span class='va'>Dest_code</span>, <span class='va'>sum</span>, value.var <span class='op'>=</span> <span class='st'>"unconstrainedEst2"</span>, margins<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Orig_code"</span>, <span class='st'>"Dest_code"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdatasubmat2</span>
</code></pre>
</div>
<pre><code>   Orig_code 1GSYD  1RNSW  2GMEL  2RVIC 3GBRI 3RQLD 4GADE 4RSAU 5GPER
1      1GSYD     0  31491  21739  23041 12353 18831 13906 16984  5598
2      1RNSW 20830      0  14890  14226  7325 14200  7786  9470  3671
3      2GMEL 18143  18786      0  72790  8171 11039 11978 19281  5567
4      2RVIC 10511   9811  39789      0  4527  5937  6901 11876  3000
5      3GBRI  7873   7058   6240   6325     0  9507  8210  6662  3508
6      3RQLD 11381  12974   7994   7865  9015     0  6586  6743  3193
7      4GADE  5854   4955   6042   6368  5423  4587     0 10284  3753
8      4RSAU  3615   3048   4918   5542  2225  2375  5201     0  1665
9      5GPER  3180   3153   3790   3736  3127  3002  5065  4445     0
10     5RWAU  1730   1670   1928   1924  1896  1655  3092  2355  3852
11     6GHOB  1907   2275   3806   3110  1118  1530  1536  2094   892
12     6RTAS  2427   2845   5372   4261  1380  1875  1933  2720  1087
13     7GDAR   911    854    891    898  1380   936  1516  1055   828
14     7RNTE   581    568    585    582   823   632   834   651   598
15     8ACTE  6264  10096   6853   6309  2149  3501  2585  3433  1207
16     (all) 95207 109584 124837 156977 60912 79607 77129 98053 38419
   5RWAU 6GHOB  6RTAS 7GDAR 7RNTE  8ACTE   (all)
1   6290 12848  13255  7463  6323  27114  217236
2   4015 10138  10279  4627  4089  28906  154452
3   5849 21394  24487  6095  5314  24756  253650
4   3190  9556  10617  3355  2888  12458  134416
5   4393  4801   4803  7207  5704   5929   88220
6   3636  6229   6189  4637  4154   9158   99754
7   4732  4354   4445  5230  3816   4709   74552
8   1823  3003   3163  1841  1508   3163   43090
9   7956  3412   3374  3856  3695   2967   54758
10     0  1651   1641  2879  2583   1549   30405
11   891     0  13610   884   805   2502   36960
12  1092 16785      0  1087   982   3214   47060
13  1277   727    725     0  2063    764   14825
14   863   499    493  1554     0    506    9769
15  1301  3894   4056  1447  1272      0   54367
16 47308 99291 101137 52162 45196 127695 1313514</code></pre>
</div>
<p>Compare with original matrix</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat</span> <span class='op'>&lt;-</span> <span class='fu'>dcast</span><span class='op'>(</span><span class='va'>mdatasub</span>, <span class='va'>Orig_code</span> <span class='op'>~</span> <span class='va'>Dest_code</span>, <span class='va'>sum</span>, value.var <span class='op'>=</span> <span class='st'>"Flow"</span>, margins<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Orig_code"</span>, <span class='st'>"Dest_code"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdatasubmat</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  91031  22601   4416  22888  27445  5817   795
2      1RNSW  53562      0  12407  13084  21300  35189  3617  1591
3      2GMEL  15560  11095      0  70260  13057  16156  6021  1300
4      2RVIC   2527  11967  48004      0   4333  10102  3461  2212
5      3GBRI  12343  16061  13078   4247      0  84649  3052   820
6      3RQLD  11634  26701  12284   7573  74410      0  3774  1751
7      4GADE   5421   3518   8810   3186   5447   6173     0 25677
8      4RSAU    477   1491   1149   2441    820   2633 22015     0
9      5GPER   6516   4066  11729   2929   5081   7006  2631   867
10     5RWAU    714   2242   1490   1813   1137   4328   807   982
11     6GHOB   1224   1000   3016    622   1307   1804   533   106
12     6RTAS   1024   1866   2639   1636   1543   2883   651   342
13     7GDAR   1238   2178   1953   1480   2769   5108  2105   641
14     7RNTE    406   1432    700    792    896   3018  1296   961
15     8ACTE   6662  15399   5229   1204   4331   3954  1359   134
16     (all) 119308 190047 145089 115683 159319 210448 57139 38179
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1  10574  2128  1644  1996  1985   832 10670  204822
2   4990  3300   970  1882  2248  1439 15779  171358
3  10116  2574  2135  2555  2023   996  4724  158572
4   3459  2601   672  1424  1547   717  1353   94379
5   4812  1798  1386  2306  1812   909  3134  150407
6   6588  4690  1499  3089  3127  2140  3115  162375
7   3829  1228   602   872  1851   921  1993   69528
8   1052  1350   142   430   681   488   183   35352
9      0 41320  1018  1805  1300   413  1666   88347
10 42146     0   277  1163  1090   623   256   59068
11   899   363     0  5025   190   115   565   16769
12  1210  1032  7215     0   268   170   292   22771
13  2152   954   243   335     0  1996   832   23984
14   699   826    96   213  2684     0   229   14248
15  1514   285   369   270   617   211     0   41538
16 94040 64449 18268 23365 21423 11970 44791 1313518</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>mdatasub</span>, 
       <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>`Flow`</span>, 
           x <span class='op'>=</span> <span class='va'>`unconstrainedEst2`</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>color<span class='op'>=</span><span class='st'>"black"</span>, fill<span class='op'>=</span><span class='st'>"light blue"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-39-1.png" width="624" /></p>
</div>
<h2 id="assessing-the-model-performance">Assessing the model performance</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>postResample</span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>Flow</span>,<span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>unconstrainedEst2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>        RMSE     Rsquared          MAE 
1.065704e+04 3.409197e-01 4.998295e+03 </code></pre>
</div>
<h1 id="origin-constrained-spatial-interaction-model">Origin Constrained Spatial Interaction Model</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>origSim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>Flow</span> <span class='op'>~</span> <span class='va'>Orig_code</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>wj3_destmedinc</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span>, na.action <span class='op'>=</span> <span class='va'>na.exclude</span>, family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>mdatasub</span><span class='op'>)</span>
<span class='co'>#let's have a look at it's summary...</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>origSim</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = Flow ~ Orig_code + log(wj3_destmedinc) + log(dist) - 
    1, family = poisson(link = &quot;log&quot;), data = mdatasub, na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-162.41   -56.28   -11.64    22.37   341.67  

Coefficients:
                     Estimate Std. Error z value Pr(&gt;|z|)    
Orig_code1GSYD      20.105260   0.023522  854.75   &lt;2e-16 ***
Orig_code1RNSW      19.903333   0.023851  834.50   &lt;2e-16 ***
Orig_code2GMEL      19.377297   0.023140  837.39   &lt;2e-16 ***
Orig_code2RVIC      18.833177   0.022898  822.48   &lt;2e-16 ***
Orig_code3GBRI      20.558867   0.024089  853.44   &lt;2e-16 ***
Orig_code3RQLD      20.495750   0.024127  849.49   &lt;2e-16 ***
Orig_code4GADE      19.566081   0.024246  806.97   &lt;2e-16 ***
Orig_code4RSAU      18.603648   0.024132  770.92   &lt;2e-16 ***
Orig_code5GPER      20.580619   0.024575  837.45   &lt;2e-16 ***
Orig_code5RWAU      19.960220   0.024588  811.78   &lt;2e-16 ***
Orig_code6GHOB      17.296706   0.024162  715.88   &lt;2e-16 ***
Orig_code6RTAS      17.502513   0.023457  746.14   &lt;2e-16 ***
Orig_code7GDAR      18.854664   0.024855  758.60   &lt;2e-16 ***
Orig_code7RNTE      18.694422   0.025925  721.11   &lt;2e-16 ***
Orig_code8ACTE      18.295418   0.023626  774.39   &lt;2e-16 ***
log(wj3_destmedinc) -0.320853   0.003376  -95.03   &lt;2e-16 ***
log(dist)           -1.261386   0.001419 -889.18   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 23087017  on 210  degrees of freedom
Residual deviance:  1174697  on 193  degrees of freedom
AIC: 1176731

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>origSimFitted</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>origSim</span><span class='op'>)</span>,<span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>create pivot table to turn paired list into matrix.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat3</span> <span class='op'>&lt;-</span> <span class='fu'>dcast</span><span class='op'>(</span><span class='va'>mdatasub</span>, <span class='va'>Orig_code</span> <span class='op'>~</span> <span class='va'>Dest_code</span>, <span class='va'>sum</span>, value.var <span class='op'>=</span> <span class='st'>"origSimFitted"</span>, margins<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Orig_code"</span>, <span class='st'>"Dest_code"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdatasubmat3</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC 3GBRI 3RQLD 4GADE 4RSAU
1      1GSYD      0  39132  22400  24332  9320 17959 11324 15284
2      1RNSW  27894      0  17029  15796  5690 15805  6335  8497
3      2GMEL   8783   9368      0  73575  2611  4186  4741  9739
4      2RVIC   5935   5406  45771      0  1648  2526  3176  7224
5      3GBRI  14588  12494  10420  10576     0 19728 15784 11436
6      3RQLD  22183  27387  13187  12790 15569     0  9797 10110
7      4GADE   5517   4329   5890   6344  4913  3864     0 13144
8      4RSAU   2994   2335   4865   5801  1431  1603  5285     0
9      5GPER   4407   4401   5857   5697  4298  4098  9083  7414
10     5RWAU   2861   2741   3432   3401  3290  2714  7027  4624
11     6GHOB    505    668   1469   1074   224   366   368   588
12     6RTAS    689    888   2350   1642   292   473   495   829
13     7GDAR   1293   1185   1273   1279  2435  1369  2851  1636
14     7RNTE    729    713    750    739  1238   840  1280   876
15     8ACTE   5227  10928   6097   5345  1027  2189  1380  2115
16     (all) 103605 121975 140790 168391 53986 77720 78926 93516
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE  8ACTE   (all)
1   2798  3339 10041 10472  4310  3398  30712  204821
2   1992  2280  9468  9618  2816  2368  45771  171359
3   1458  1570 11460 13998  1664  1370  14048  158571
4    882   968  5213  6086  1040   840   7661   94376
5   4271  6008  6979  6945 12702  9030   9445  150406
6   3214  3911  9002  8866  5637  4837  15885  162375
7   2810  3995  3571  3665  4630  2908   3949   69529
8    922  1057  2291  2467  1068   800   2434   35353
9      0 17802  4982  4870  5887  5599   3954   88349
10  9687     0  2706  2667  6186  5321   2411   59068
11   159   159     0 10135   156   137    760   16768
12   204   205 13272     0   202   176   1054   22771
13  1121  2165   932   922     0  4536    987   23984
14   762  1332   586   573  3243     0    588   14249
15   427   479  2574  2724   560   467      0   41539
16 30707 45270 83077 84008 50101 41787 139659 1313518</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  91031  22601   4416  22888  27445  5817   795
2      1RNSW  53562      0  12407  13084  21300  35189  3617  1591
3      2GMEL  15560  11095      0  70260  13057  16156  6021  1300
4      2RVIC   2527  11967  48004      0   4333  10102  3461  2212
5      3GBRI  12343  16061  13078   4247      0  84649  3052   820
6      3RQLD  11634  26701  12284   7573  74410      0  3774  1751
7      4GADE   5421   3518   8810   3186   5447   6173     0 25677
8      4RSAU    477   1491   1149   2441    820   2633 22015     0
9      5GPER   6516   4066  11729   2929   5081   7006  2631   867
10     5RWAU    714   2242   1490   1813   1137   4328   807   982
11     6GHOB   1224   1000   3016    622   1307   1804   533   106
12     6RTAS   1024   1866   2639   1636   1543   2883   651   342
13     7GDAR   1238   2178   1953   1480   2769   5108  2105   641
14     7RNTE    406   1432    700    792    896   3018  1296   961
15     8ACTE   6662  15399   5229   1204   4331   3954  1359   134
16     (all) 119308 190047 145089 115683 159319 210448 57139 38179
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1  10574  2128  1644  1996  1985   832 10670  204822
2   4990  3300   970  1882  2248  1439 15779  171358
3  10116  2574  2135  2555  2023   996  4724  158572
4   3459  2601   672  1424  1547   717  1353   94379
5   4812  1798  1386  2306  1812   909  3134  150407
6   6588  4690  1499  3089  3127  2140  3115  162375
7   3829  1228   602   872  1851   921  1993   69528
8   1052  1350   142   430   681   488   183   35352
9      0 41320  1018  1805  1300   413  1666   88347
10 42146     0   277  1163  1090   623   256   59068
11   899   363     0  5025   190   115   565   16769
12  1210  1032  7215     0   268   170   292   22771
13  2152   954   243   335     0  1996   832   23984
14   699   826    96   213  2684     0   229   14248
15  1514   285   369   270   617   211     0   41538
16 94040 64449 18268 23365 21423 11970 44791 1313518</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>mdatasub</span>, 
       <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>`Flow`</span>, 
           x <span class='op'>=</span> <span class='va'>`origSimFitted`</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>color<span class='op'>=</span><span class='st'>"black"</span>, fill<span class='op'>=</span><span class='st'>"light blue"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-45-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>postResample</span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>Flow</span>,<span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>origSimFitted</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>        RMSE     Rsquared          MAE 
9552.4663482    0.4713914 4676.7428571 </code></pre>
</div>
<h1 id="destination-constrained-spatial-interaction-model">Destination Constrained Spatial Interaction Model</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>destSim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>Flow</span> <span class='op'>~</span> <span class='va'>Dest_code</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>vi1_origpop</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span><span class='op'>-</span><span class='fl'>1</span>, na.action <span class='op'>=</span> <span class='va'>na.exclude</span>, family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>mdatasub</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>destSim</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = Flow ~ Dest_code + log(vi1_origpop) + log(dist) - 
    1, family = poisson(link = &quot;log&quot;), data = mdatasub, na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-130.75   -32.60   -11.98    15.44   290.68  

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
Dest_code1GSYD    8.7549173  0.0175475   498.9   &lt;2e-16 ***
Dest_code1RNSW    9.1380848  0.0174815   522.7   &lt;2e-16 ***
Dest_code2GMEL    8.6365848  0.0167940   514.3   &lt;2e-16 ***
Dest_code2RVIC    8.0585586  0.0171615   469.6   &lt;2e-16 ***
Dest_code3GBRI    9.7335278  0.0182676   532.8   &lt;2e-16 ***
Dest_code3RQLD    9.7635251  0.0180565   540.7   &lt;2e-16 ***
Dest_code4GADE    8.5386778  0.0184097   463.8   &lt;2e-16 ***
Dest_code4RSAU    7.7538776  0.0184265   420.8   &lt;2e-16 ***
Dest_code5GPER    9.8566397  0.0187450   525.8   &lt;2e-16 ***
Dest_code5RWAU    9.1928390  0.0187449   490.4   &lt;2e-16 ***
Dest_code6GHOB    6.9255789  0.0184232   375.9   &lt;2e-16 ***
Dest_code6RTAS    7.1075262  0.0181525   391.5   &lt;2e-16 ***
Dest_code7GDAR    7.9276108  0.0194661   407.3   &lt;2e-16 ***
Dest_code7RNTE    7.6923550  0.0206243   373.0   &lt;2e-16 ***
Dest_code8ACTE    7.3576260  0.0179247   410.5   &lt;2e-16 ***
log(vi1_origpop)  0.5758189  0.0009403   612.4   &lt;2e-16 ***
log(dist)        -1.1565323  0.0014962  -773.0   &lt;2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 23087017  on 210  degrees of freedom
Residual deviance:   670267  on 193  degrees of freedom
AIC: 672300

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>destSimFitted</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>destSim</span><span class='op'>)</span>,<span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat6</span> <span class='op'>&lt;-</span> <span class='fu'>dcast</span><span class='op'>(</span><span class='va'>mdatasub</span>, <span class='va'>Orig_code</span> <span class='op'>~</span> <span class='va'>Dest_code</span>, <span class='va'>sum</span>, value.var <span class='op'>=</span> <span class='st'>"destSimFitted"</span>, margins<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Orig_code"</span>, <span class='st'>"Dest_code"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdatasubmat6</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  62384  21214  13683  34240  54902 10561  6649
2      1RNSW  30836      0  14396   8034  19004  42609  5410  3387
3      2GMEL  22628  31067      0  69711  19691  26681  8780  8124
4      2RVIC  13894  16504  66361      0  11362  14767  5350  5433
5      3GBRI   8336   9360   4494   2724      0  25573  6120  2178
6      3RQLD  13637  21412   6213   3612  26091      0  4403  2167
7      4GADE   6286   6515   4899   3136  14963  10550     0  4551
8      4RSAU   4341   4474   4973   3494   5841   5696  4993     0
9      5GPER   2461   3181   2344   1367   6366   5355  3262  1295
10     5RWAU   1436   1787   1245    738   4321   3182  2236   728
11     6GHOB   2045   3420   3997   1794   2571   3545  1046   768
12     6RTAS   2661   4345   6013   2588   3205   4378  1342  1029
13     7GDAR    840   1003    608    365   3971   2059  1184   340
14     7RNTE    484    613    365    215   2081   1282   554   187
15     8ACTE   9423  23982   7966   4221   5611   9868  1898  1343
16     (all) 119308 190047 145088 115682 159318 210447 57139 38179
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1  12669  7753  1882  2487  2910  1575  9892  242801
2   8093  4769  1556  2007  1719   987 12444  155251
3  12872  7172  3923  5995  2246  1265  8919  229074
4   7143  4048  1676  2457  1284   711  4499  155489
5   7978  5678   576   729  3350  1649  1434   80179
6   6847  4267   810  1017  1772  1037  2573   95858
7   9994  7184   573   747  2443  1073  1186   74100
8   4352  2568   462   628   770   397   920   43909
9      0 13599   374   466  1464   941   571   43046
10 12967     0   185   233  1329   779   314   31480
11  2093  1087     0  5529   318   190   763   29166
12  2567  1344  5443     0   395   234  1006   36550
13  2175  2070    85   106     0   815   168   15789
14  1489  1292    54    67   868     0   102    9653
15  2800  1617   669   896   555   316     0   71165
16 94039 64448 18268 23364 21423 11969 44791 1313510</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  91031  22601   4416  22888  27445  5817   795
2      1RNSW  53562      0  12407  13084  21300  35189  3617  1591
3      2GMEL  15560  11095      0  70260  13057  16156  6021  1300
4      2RVIC   2527  11967  48004      0   4333  10102  3461  2212
5      3GBRI  12343  16061  13078   4247      0  84649  3052   820
6      3RQLD  11634  26701  12284   7573  74410      0  3774  1751
7      4GADE   5421   3518   8810   3186   5447   6173     0 25677
8      4RSAU    477   1491   1149   2441    820   2633 22015     0
9      5GPER   6516   4066  11729   2929   5081   7006  2631   867
10     5RWAU    714   2242   1490   1813   1137   4328   807   982
11     6GHOB   1224   1000   3016    622   1307   1804   533   106
12     6RTAS   1024   1866   2639   1636   1543   2883   651   342
13     7GDAR   1238   2178   1953   1480   2769   5108  2105   641
14     7RNTE    406   1432    700    792    896   3018  1296   961
15     8ACTE   6662  15399   5229   1204   4331   3954  1359   134
16     (all) 119308 190047 145089 115683 159319 210448 57139 38179
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1  10574  2128  1644  1996  1985   832 10670  204822
2   4990  3300   970  1882  2248  1439 15779  171358
3  10116  2574  2135  2555  2023   996  4724  158572
4   3459  2601   672  1424  1547   717  1353   94379
5   4812  1798  1386  2306  1812   909  3134  150407
6   6588  4690  1499  3089  3127  2140  3115  162375
7   3829  1228   602   872  1851   921  1993   69528
8   1052  1350   142   430   681   488   183   35352
9      0 41320  1018  1805  1300   413  1666   88347
10 42146     0   277  1163  1090   623   256   59068
11   899   363     0  5025   190   115   565   16769
12  1210  1032  7215     0   268   170   292   22771
13  2152   954   243   335     0  1996   832   23984
14   699   826    96   213  2684     0   229   14248
15  1514   285   369   270   617   211     0   41538
16 94040 64449 18268 23365 21423 11970 44791 1313518</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>mdatasub</span>, 
       <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>`Flow`</span>, 
           x <span class='op'>=</span> <span class='va'>`destSimFitted`</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>color<span class='op'>=</span><span class='st'>"black"</span>, fill<span class='op'>=</span><span class='st'>"light blue"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-51-1.png" width="624" /></p>
</div>
<p>Test the Goodness-of-Fit in exactly the same way as before:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>postResample</span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>Flow</span>,<span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>destSimFitted</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>        RMSE     Rsquared          MAE 
7851.9808377    0.6422222 3468.3238095 </code></pre>
</div>
<h1 id="doubly-constrained-spatial-interaction-model">Doubly Constrained Spatial Interaction Model</h1>
<p>Calibrate a Doubly Constrained Spatial Interaction Model by using glm()</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>doubSim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/glm.html'>glm</a></span><span class='op'>(</span><span class='va'>Flow</span> <span class='op'>~</span> <span class='va'>Orig_code</span><span class='op'>+</span><span class='va'>Dest_code</span><span class='op'>+</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>dist</span><span class='op'>)</span>, na.action <span class='op'>=</span> <span class='va'>na.exclude</span>, family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span>link <span class='op'>=</span> <span class='st'>"log"</span><span class='op'>)</span>, data <span class='op'>=</span> <span class='va'>mdatasub</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>doubSim</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Call:
glm(formula = Flow ~ Orig_code + Dest_code + log(dist), family = poisson(link = &quot;log&quot;), 
    data = mdatasub, na.action = na.exclude)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-97.789  -21.987    3.187   21.846  184.552  

Coefficients:
                Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept)    19.818460   0.011164 1775.290  &lt; 2e-16 ***
Orig_code1RNSW -0.023550   0.003451   -6.824 8.88e-12 ***
Orig_code2GMEL -0.364515   0.003709  -98.268  &lt; 2e-16 ***
Orig_code2RVIC -1.321412   0.004499 -293.735  &lt; 2e-16 ***
Orig_code3GBRI  0.630975   0.003622  174.196  &lt; 2e-16 ***
Orig_code3RQLD  0.492313   0.003485  141.271  &lt; 2e-16 ***
Orig_code4GADE -0.391453   0.004553  -85.971  &lt; 2e-16 ***
Orig_code4RSAU -1.310826   0.005854 -223.934  &lt; 2e-16 ***
Orig_code5GPER  0.817654   0.004622  176.915  &lt; 2e-16 ***
Orig_code5RWAU -0.223499   0.005093  -43.887  &lt; 2e-16 ***
Orig_code6GHOB -2.194174   0.008513 -257.733  &lt; 2e-16 ***
Orig_code6RTAS -1.916039   0.007420 -258.237  &lt; 2e-16 ***
Orig_code7GDAR -1.176797   0.006986 -168.441  &lt; 2e-16 ***
Orig_code7RNTE -1.262611   0.008859 -142.516  &lt; 2e-16 ***
Orig_code8ACTE -1.933582   0.005437 -355.660  &lt; 2e-16 ***
Dest_code1RNSW  0.486417   0.003880  125.360  &lt; 2e-16 ***
Dest_code2GMEL  0.066942   0.004218   15.870  &lt; 2e-16 ***
Dest_code2RVIC -0.690453   0.004643 -148.713  &lt; 2e-16 ***
Dest_code3GBRI  1.168768   0.004051  288.547  &lt; 2e-16 ***
Dest_code3RQLD  1.168812   0.003776  309.528  &lt; 2e-16 ***
Dest_code4GADE -0.097925   0.005242  -18.681  &lt; 2e-16 ***
Dest_code4RSAU -0.794046   0.005978 -132.836  &lt; 2e-16 ***
Dest_code5GPER  1.380165   0.004930  279.963  &lt; 2e-16 ***
Dest_code5RWAU  0.368701   0.005297   69.604  &lt; 2e-16 ***
Dest_code6GHOB -1.619560   0.008415 -192.462  &lt; 2e-16 ***
Dest_code6RTAS -1.393020   0.007555 -184.396  &lt; 2e-16 ***
Dest_code7GDAR -0.799177   0.007579 -105.442  &lt; 2e-16 ***
Dest_code7RNTE -0.940912   0.009775  -96.256  &lt; 2e-16 ***
Dest_code8ACTE -1.417944   0.005602 -253.113  &lt; 2e-16 ***
log(dist)      -1.546886   0.001646 -939.823  &lt; 2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 2750417  on 209  degrees of freedom
Residual deviance:  353996  on 180  degrees of freedom
AIC: 356055

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<p>We can examine how the constraints hold for destinations this time. Firstly, we will fitted the model and roundup the estimated values by using the code chunk below.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>doubsimFitted</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>doubSim</span><span class='op'>)</span>,<span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat7</span> <span class='op'>&lt;-</span> <span class='fu'>dcast</span><span class='op'>(</span><span class='va'>mdatasub</span>, <span class='va'>Orig_code</span> <span class='op'>~</span> <span class='va'>Dest_code</span>, <span class='va'>sum</span>, value.var <span class='op'>=</span> <span class='st'>"doubsimFitted"</span>, margins<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Orig_code"</span>, <span class='st'>"Dest_code"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mdatasubmat7</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  64231  19512  11026  25687  46407  7421  5691
2      1RNSW  38571      0  17443   8122  17548  49641  4554  3466
3      2GMEL  12674  18867      0  72636   9148  13194  4326  5553
4      2RVIC   5867   7196  59499      0   3897   5315  1982  2882
5      3GBRI  15002  17066   8225   4277      0  56110 12016  4297
6      3RQLD  23593  42026  10327   5079  48843      0  6297  3474
7      4GADE   5533   5655   4966   2777  15341   9235     0  6194
8      4RSAU   3394   3442   5099   3230   4388   4076  4955     0
9      5GPER   4057   5570   4762   2350  12572   9583  7160  2963
10     5RWAU   1805   2355   1868    943   6844   4368  3949  1255
11     6GHOB    785   1522   2411    839    927   1369   388   366
12     6RTAS   1181   2217   4401   1448   1317   1920   572   572
13     7GDAR   1019   1260    828    425   7075   2823  1954   525
14     7RNTE    564    754    483    242   3447   1732   818   272
15     8ACTE   5263  17886   5265   2288   2287   4675   747   670
16     (all) 119308 190047 145089 115682 159321 210448 57139 38180
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1   7120  3263  1395  1992  1486   777  8814  204822
2   5871  2557  1624  2246  1103   624 17988  171358
3   5428  2194  2782  4823   785   433  5728  158571
4   2195   907   793  1300   330   178  2038   94379
5  12887  7226   962  1297  6028  2777  2237  150407
6   8550  4015  1237  1646  2094  1215  3980  162376
7   9370  5324   514   720  2125   841   933   69528
8   3102  1353   387   575   456   224   669   35350
9      0 32128   747   985  2755  1813   902   88347
10 31188     0   267   356  2212  1287   372   59069
11   738   272     0  6681    89    53   330   16770
12  1025   381  7034     0   125    74   505   22772
13  3314  2741   108   145     0  1583   186   23986
14  2307  1687    68    90  1674     0   110   14248
15   946   401   350   509   162    91     0   41540
16 94041 64449 18268 23365 21424 11970 44792 1313523</code></pre>
</div>
<p>Next, we will used the step you had learned in previous section to create pivot table to turn paired list into matrix.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mdatasubmat</span>
</code></pre>
</div>
<pre><code>   Orig_code  1GSYD  1RNSW  2GMEL  2RVIC  3GBRI  3RQLD 4GADE 4RSAU
1      1GSYD      0  91031  22601   4416  22888  27445  5817   795
2      1RNSW  53562      0  12407  13084  21300  35189  3617  1591
3      2GMEL  15560  11095      0  70260  13057  16156  6021  1300
4      2RVIC   2527  11967  48004      0   4333  10102  3461  2212
5      3GBRI  12343  16061  13078   4247      0  84649  3052   820
6      3RQLD  11634  26701  12284   7573  74410      0  3774  1751
7      4GADE   5421   3518   8810   3186   5447   6173     0 25677
8      4RSAU    477   1491   1149   2441    820   2633 22015     0
9      5GPER   6516   4066  11729   2929   5081   7006  2631   867
10     5RWAU    714   2242   1490   1813   1137   4328   807   982
11     6GHOB   1224   1000   3016    622   1307   1804   533   106
12     6RTAS   1024   1866   2639   1636   1543   2883   651   342
13     7GDAR   1238   2178   1953   1480   2769   5108  2105   641
14     7RNTE    406   1432    700    792    896   3018  1296   961
15     8ACTE   6662  15399   5229   1204   4331   3954  1359   134
16     (all) 119308 190047 145089 115683 159319 210448 57139 38179
   5GPER 5RWAU 6GHOB 6RTAS 7GDAR 7RNTE 8ACTE   (all)
1  10574  2128  1644  1996  1985   832 10670  204822
2   4990  3300   970  1882  2248  1439 15779  171358
3  10116  2574  2135  2555  2023   996  4724  158572
4   3459  2601   672  1424  1547   717  1353   94379
5   4812  1798  1386  2306  1812   909  3134  150407
6   6588  4690  1499  3089  3127  2140  3115  162375
7   3829  1228   602   872  1851   921  1993   69528
8   1052  1350   142   430   681   488   183   35352
9      0 41320  1018  1805  1300   413  1666   88347
10 42146     0   277  1163  1090   623   256   59068
11   899   363     0  5025   190   115   565   16769
12  1210  1032  7215     0   268   170   292   22771
13  2152   954   243   335     0  1996   832   23984
14   699   826    96   213  2684     0   229   14248
15  1514   285   369   270   617   211     0   41538
16 94040 64449 18268 23365 21423 11970 44791 1313518</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>mdatasub</span>, 
       <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>`Flow`</span>, 
           x <span class='op'>=</span> <span class='va'>`doubsimFitted`</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>color<span class='op'>=</span><span class='st'>"black"</span>, fill<span class='op'>=</span><span class='st'>"light blue"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="hands-on-exercise-10_files/figure-html5/unnamed-chunk-57-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>postResample</span><span class='op'>(</span><span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>Flow</span>,<span class='va'>mdatasub</span><span class='op'>$</span><span class='va'>doubsimFitted</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>        RMSE     Rsquared          MAE 
5129.1796304    0.8498904 2538.1190476 </code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
